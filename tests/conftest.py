import numpy as np
import pytest

from signaturizer3d.signaturizer import Signaturizer
from signaturizer3d.types import CCSpace


@pytest.fixture(scope="session")
def signaturizer():
    return Signaturizer(space=CCSpace.A1)


@pytest.fixture
def atoms_coords_sig_single():
    atoms_list = [["B", "C", "C", "C", "C", "N", "H", "H", "H", "H", "H", "H"]]
    coordinates_list = [
        [
            [0.76156634, 1.2901858, 0.12924457],
            [1.4757344, -0.1085879, 0.09344932],
            [0.7114183, -1.1806082, 0.01709275],
            [-0.72594887, -1.1575478, -0.03549586],
            [-1.4123001, -0.02897997, -0.01073238],
            [-0.76860493, 1.2356759, 0.0697298],
            [1.2897854, 2.266084, -0.32639045],
            [2.5406199, -0.13042219, 0.13219301],
            [1.1984242, -2.155398, -0.00828129],
            [-1.274312, -2.1070712, -0.09834784],
            [-2.4981077, -0.05773742, -0.05257103],
            [-1.2982749, 2.134407, 0.09010937],
        ]
    ]
    expected_sig = [
        [
            -0.091901645,
            -0.09102313,
            -0.09195763,
            0.09152083,
            -0.089310884,
            0.09121277,
            0.09218343,
            -0.09229402,
            0.09301653,
            0.09203337,
            0.07123147,
            0.08957938,
            0.091644585,
            -0.054172147,
            0.09245696,
            0.091248706,
            0.09300228,
            -0.09098136,
            0.087012805,
            0.09110507,
            -0.08115458,
            -0.09235038,
            -0.09102786,
            0.090946734,
            0.089944676,
            -0.09157614,
            -0.091513745,
            0.092085674,
            0.06481226,
            -0.09378505,
            0.09060381,
            -0.09153648,
            -0.09211121,
            0.09246269,
            -0.09189809,
            -0.09049988,
            -0.09189284,
            -0.07696572,
            0.091249034,
            0.025923269,
            -0.09036369,
            -0.09093014,
            0.09249968,
            0.09242105,
            0.09363893,
            -0.090838775,
            0.091824,
            0.092437625,
            0.07664947,
            0.092293926,
            0.09199075,
            -0.092839025,
            0.09116948,
            0.09050898,
            0.09054657,
            -0.09114833,
            -0.09107602,
            0.09162588,
            0.08902782,
            0.0914679,
            0.09167187,
            -0.09154969,
            -0.09142803,
            -0.08482643,
            0.06363664,
            -0.091587976,
            -0.09143286,
            -0.08153253,
            0.09061097,
            0.092061944,
            0.061057977,
            0.09266772,
            0.09127877,
            -0.09072692,
            -0.09141136,
            -0.09218056,
            -0.0908739,
            -0.089152776,
            0.09134478,
            0.09269777,
            -0.09187877,
            0.08677011,
            0.089869715,
            0.066298895,
            -0.092297986,
            -0.08191085,
            -0.09061867,
            -0.09163094,
            0.09183798,
            -0.09116055,
            -0.090404145,
            0.090558864,
            0.09099581,
            -0.092860945,
            -0.0909899,
            -0.091464385,
            0.08480933,
            -0.09192329,
            0.0899132,
            0.086263835,
            -0.087560885,
            -0.04185001,
            0.09134166,
            -0.089117944,
            0.09180308,
            -0.09255306,
            0.07959912,
            0.09060471,
            -0.09263428,
            0.09219299,
            -0.09319409,
            0.09127513,
            -0.09175856,
            0.0071260342,
            -0.09045928,
            -0.0905566,
            0.04989493,
            -0.09070824,
            0.09184132,
            0.09394171,
            0.08742684,
            0.0053533902,
            0.02425228,
            0.09170674,
            -0.092383884,
            0.09194965,
            -0.090813346,
            -0.0914259,
        ]
    ]
    return atoms_list, coordinates_list, expected_sig


@pytest.fixture
def signature_C():
    smiles = "C"
    # Signature captured with A1 model loaded in unimol_tools
    # fmt: off
    signature_c = np.array([[
        -0.09176869, -0.09230309, -0.09278876,  0.09095952,  0.02165126,
         0.09216648,  0.09049753, -0.09008787,  0.09142682,  0.09209616,
        -0.06786694,  0.04880361,  0.08967396,  0.09168409,  0.09159772,
        -0.06577322,  0.09233385, -0.0921234 ,  0.09194953,  0.09216952,
        -0.08310705, -0.09195956, -0.09126031,  0.09194492,  0.09090706,
        -0.09114204, -0.03240291,  0.0931712 , -0.0859022 , -0.09080284,
         0.09140556, -0.09105089, -0.0916431 ,  0.09313102, -0.09121914,
        -0.09175517, -0.09277003, -0.08987983,  0.09163205,  0.03126003,
        -0.09216055, -0.09082175,  0.09192075,  0.09139172,  0.09247874,
        -0.09078471,  0.09024763,  0.09304998,  0.09086962,  0.09217969,
         0.09209364, -0.09072731,  0.09105907,  0.09101547,  0.09090669,
        -0.09060563, -0.09145523,  0.09112076,  0.09169028,  0.0908412 ,
         0.07901774, -0.03512888, -0.09115534, -0.09188529, -0.0315344 ,
        -0.09231444, -0.09149101, -0.09205813,  0.09160269,  0.09196097,
        -0.05865292,  0.09252463,  0.09130077, -0.09172446,  0.09140788,
        -0.09272634, -0.09075181,  0.09141561,  0.09332587,  0.0913637 ,
        -0.09172942,  0.09121083,  0.09034466, -0.0928335 , -0.0919898 ,
        -0.09228481, -0.0919136 , -0.09175359,  0.07191183, -0.09117071,
        -0.09038644,  0.09112086,  0.09153802, -0.08514521, -0.08704499,
        -0.09099759,  0.09055719, -0.09135619,  0.06394509,  0.07074568,
        -0.08616739,  0.04808807,  0.09245519, -0.09404121,  0.09124337,
        -0.09228519,  0.04805079,  0.09180605, -0.09080315,  0.09146774,
        -0.08064783, -0.04875047, -0.08551046,  0.0728785 , -0.09180541,
        -0.08521657, -0.09262581, -0.09190093,  0.0916356 ,  0.09203634,
         0.07872167, -0.07670218, -0.07603158,  0.09193884, -0.09102505,
         0.09146956, -0.0918367 , -0.08955827]], dtype=np.float32)
    # fmt: on
    return smiles, signature_c
